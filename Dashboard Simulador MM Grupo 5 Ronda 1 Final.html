<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cuadro de Mando Integral ‚Äî Grupo 5</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');

  /* MODO CLARO (Por Defecto) */
  :root[data-theme="light"] {
    --bg: #f4f6f9;
    --surface: #ffffff;
    --card: #ffffff;
    --border: #e2e8f0;
    --accent: #4f8bff;     
    --accent2: #00e5c3;    
    --accent3: #ff4d6d;    
    --accent4: #f59e0b;    
    --green: #10b981;      
    --red: #ef4444;        
    --text: #1e293b;
    --text-chart: #64748b;
    --grid-chart: rgba(0,0,0,0.06);
    --muted: #64748b;
    --tooltip-bg: #ffffff;
    --title-color: #BA0C2F; 
  }

  /* MODO OSCURO */
  :root[data-theme="dark"] {
    --bg: #0a0f1e;
    --surface: #0f1629;
    --card: #141c35;
    --border: #1e2d55;
    --accent: #4f8bff;
    --accent2: #00e5c3;
    --accent3: #ff6b6b;
    --accent4: #ffd166;
    --green: #22d67c;
    --red: #ff4d6d;
    --text: #e8eeff;
    --text-chart: #7a8ab8;
    --grid-chart: rgba(255,255,255,0.06);
    --muted: #7a8ab8;
    --tooltip-bg: #0f1629;
    --title-color: #BA0C2F;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--bg); color: var(--text); font-family: 'Poppins', sans-serif; min-height: 100vh; overflow-x: hidden; transition: background-color 0.3s, color 0.3s; }
  body::before { content: ''; position: fixed; inset: 0; background-image: linear-gradient(var(--border) 1px, transparent 1px), linear-gradient(90deg, var(--border) 1px, transparent 1px); background-size: 40px 40px; opacity: 0.4; pointer-events: none; z-index: 0; }
  .container { position: relative; z-index: 1; max-width: 1440px; margin: 0 auto; padding: 32px 28px; }

  header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; border-bottom: 1px solid var(--border); padding-bottom: 24px; }
  .header-left h1 { font-size: 2.2rem; font-weight: 800; color: var(--title-color); line-height: 1.2; margin-bottom: 4px; }
  .header-left p { color: var(--muted); font-size: 0.95rem; font-weight: 500; }
  .header-right { display: flex; align-items: center; gap: 30px; text-align: right; }
  .theme-btn { background: var(--surface); color: var(--text); border: 1px solid var(--border); padding: 10px 18px; border-radius: 8px; cursor: pointer; font-family: 'Poppins', sans-serif; font-weight: 600; font-size: 0.85rem; transition: all 0.2s; }
  .theme-btn:hover { border-color: var(--accent); color: var(--accent); }
  .header-right .big-kpi { font-size: 2.5rem; font-weight: 800; color: var(--green); }
  .header-right .kpi-label { font-size: 0.75rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.1em; }

  .tabs { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 24px; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 6px; width: fit-content; }
  .tab { padding: 10px 20px; border-radius: 7px; cursor: pointer; font-size: 0.85rem; font-weight: 600; color: var(--muted); border: none; background: transparent; font-family: 'Poppins', sans-serif; transition: all 0.2s; }
  .tab.active { background: var(--accent); color: #fff; }

  .panel { display: none; }
  .panel.active { display: block; animation: fadeIn 0.4s ease; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

  .section-label { font-size: 0.75rem; font-weight: 700; letter-spacing: 0.15em; text-transform: uppercase; color: var(--accent); margin-bottom: 16px; display: flex; align-items: center; gap: 12px; }
  .section-label::after { content: ''; flex: 1; height: 1px; background: var(--border); }

  .kpi-strip { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin-bottom: 28px; }
  .kpi-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 22px; position: relative; }
  .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; border-radius: 12px 12px 0 0; }
  .kpi-card.blue::before { background: var(--accent); } .kpi-card.teal::before { background: var(--accent2); }
  .kpi-card.red::before { background: var(--accent3); } .kpi-card.yellow::before { background: var(--accent4); }
  .kpi-card .kpi-value { font-size: 1.8rem; font-weight: 700; margin-bottom: 4px; }
  .kpi-card.blue .kpi-value { color: var(--accent); } .kpi-card.teal .kpi-value { color: var(--accent2); }
  .kpi-card.red .kpi-value { color: var(--accent3); } .kpi-card.yellow .kpi-value { color: var(--accent4); }
  .kpi-card .kpi-label { font-size: 0.8rem; color: var(--muted); font-weight: 500; }
  .kpi-card .kpi-change { font-size: 0.75rem; margin-top: 8px; display: flex; align-items: center; gap: 4px; font-weight: 500; }
  .kpi-card .kpi-change.up { color: var(--green); } .kpi-card .kpi-change.down { color: var(--red); }

  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
  .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px; }
  .grid-2-3 { display: grid; grid-template-columns: 2fr 1.2fr; gap: 20px; margin-bottom: 20px; }

  .chart-card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 24px; display: flex; flex-direction: column; overflow: hidden; }
  .chart-card .chart-title { font-size: 0.95rem; font-weight: 700; color: var(--text); margin-bottom: 4px; }
  .chart-card .chart-subtitle { font-size: 0.78rem; color: var(--muted); margin-bottom: 20px; }
  .chart-wrapper { position: relative; flex-grow: 1; min-height: 250px; width: 100%; }

  .comparison-section { display: grid; grid-template-columns: 1fr auto 1fr; gap: 20px; align-items: stretch; background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 24px; margin-bottom: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); }
  .comp-block { text-align: center; display: flex; flex-direction: column; }
  .comp-block h4 { font-size: 1.05rem; color: var(--text); margin-bottom: 4px; font-weight: 700; }
  .comp-label { font-size: 0.8rem; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 16px; }
  .comp-cards { display: flex; gap: 12px; flex: 1; flex-wrap: wrap; }
  .c-card { flex: 1; min-width: 130px; background: var(--bg); border: 1px solid var(--border); border-radius: 10px; padding: 18px 12px; display: flex; flex-direction: column; justify-content: center; transition: transform 0.2s; }
  .c-card:hover { transform: translateY(-3px); }
  .c-card-title { font-size: 0.85rem; font-weight: 700; margin-bottom: 8px; text-transform: uppercase; }
  .c-card-value { font-size: 1.6rem; font-weight: 800; line-height: 1.2; margin-bottom: 2px; }
  .c-card-sub { font-size: 0.75rem; color: var(--muted); margin-bottom: 12px; }
  .c-card-money { font-size: 1.1rem; font-weight: 700; color: var(--text); }
  .c-card-lbl { font-size: 0.7rem; color: var(--muted); text-transform: uppercase; margin-top: 2px; }
  .comp-vs { font-size: 1.2rem; font-weight: 800; color: var(--muted); background: var(--surface); width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 2px solid var(--border); align-self: center; margin: 0 auto; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }

  .executive-summary { background: rgba(186, 12, 47, 0.05); border-left: 4px solid var(--title-color); padding: 24px 28px; border-radius: 0 8px 8px 0; margin-top: 10px; margin-bottom: 20px; }
  .executive-summary h3 { font-size: 1.1rem; color: var(--title-color); margin-bottom: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
  .executive-summary p { font-size: 0.92rem; line-height: 1.7; color: var(--text); text-align: justify; margin-bottom: 12px; }

  .snapshot-control { background: rgba(79, 139, 255, 0.05); border: 1px solid var(--accent); border-radius: 10px; padding: 16px 20px; margin-bottom: 24px; display: flex; flex-direction: column; gap: 12px; }
  .snapshot-header { display: flex; justify-content: space-between; align-items: center; }
  .snapshot-title { font-size: 0.9rem; font-weight: 700; color: var(--accent); text-transform: uppercase; letter-spacing: 0.05em; }
  .snapshot-value { font-size: 1.2rem; font-weight: 800; color: var(--text); background: var(--surface); padding: 4px 12px; border-radius: 6px; border: 1px solid var(--border); }
  input[type=range] { width: 100%; accent-color: var(--accent); cursor: pointer; }

  .sat-row { display: flex; align-items: center; gap: 14px; margin-bottom: 14px; }
  .sat-label { width: 110px; font-size: 0.8rem; color: var(--muted); font-weight: 600; flex-shrink: 0; }
  .sat-bar-bg { flex: 1; height: 10px; background: var(--bg); border-radius: 5px; overflow: hidden; }
  .sat-bar-fill { height: 100%; border-radius: 5px; transition: width 0.4s ease, background-color 0.4s ease; }
  .sat-score { width: 40px; text-align: right; font-size: 0.85rem; font-weight: 700; color: var(--text); }

  .narrative-box { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 28px; margin-bottom: 20px; }
  .narrative-box h3 { font-size: 1.1rem; color: var(--accent); margin-bottom: 16px; text-transform: uppercase; }
  .narrative-box h4 { font-size: 0.95rem; color: var(--text); margin-top: 16px; margin-bottom: 8px; }
  .narrative-box p, .narrative-box li { font-size: 0.9rem; line-height: 1.7; color: var(--text); margin-bottom: 10px; }
  .narrative-box ul { margin-left: 20px; margin-bottom: 16px; }

  .decision-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; min-width: 800px; }
  .decision-table th { background: rgba(79,139,255,0.06); color: var(--accent); padding: 12px; text-align: left; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; border-bottom: 1px solid var(--border); }
  .decision-table td { padding: 12px; border-bottom: 1px solid var(--border); color: var(--text); font-weight: 500; }
  .table-responsive { overflow-x: auto; width: 100%; }

  .pill { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
  .pill-high { background: rgba(16,185,129,0.15); color: var(--green); }
  .pill-med  { background: rgba(79,139,255,0.15); color: var(--accent); }
  .pill-low  { background: rgba(239,68,68,0.15); color: var(--red); }

  @media (max-width: 992px) {
    .grid-2, .grid-2-3 { grid-template-columns: 1fr; }
    .comparison-section { grid-template-columns: 1fr; gap: 16px; }
    .comp-vs { transform: rotate(90deg); margin: 10px auto; }
    header { flex-direction: column; align-items: flex-start; gap: 16px; }
    .header-right { width: 100%; justify-content: space-between; }
  }
</style>
</head>
<body>
<div class="container">

  <header>
    <div class="header-left">
      <h1>Cuadro de Mando Integral ‚Äî Grupo 5</h1>
      <p>Materia: Simulaciones Gerenciales de Ventas</p>
    </div>
    <div class="header-right">
      <button id="themeToggle" class="theme-btn" onclick="toggleTheme()">üåô Modo Oscuro</button>
      <div>
        <div class="kpi-label">Beneficio Acumulado Final</div>
        <div class="big-kpi">$4.43M</div>
        <div style="font-size:0.75rem;color:var(--muted);margin-top:4px;">16 quarters ¬∑ Y1Q1 ‚Üí Y4Q4</div>
      </div>
    </div>
  </header>

  <div class="tabs">
    <button class="tab active" onclick="switchTab(this, 'financiero')">üìä Financiero</button>
    <button class="tab" onclick="switchTab(this, 'cuota')">üìà Cuota vs Ingresos</button>
    <button class="tab" onclick="switchTab(this, 'comercial')">üõí Comercial</button>
    <button class="tab" onclick="switchTab(this, 'fuerzaventas')">üë• Fuerza de Ventas</button>
    <button class="tab" onclick="switchTab(this, 'decisiones')">üéØ Decisiones vs Resultados</button>
    <button class="tab" onclick="switchTab(this, 'narrativa')">üìù Narrativas de Gesti√≥n</button>
  </div>

  <div id="panel-financiero" class="panel active">
    <div class="section-label">√Årea Financiera ‚Äî Indicadores Clave</div>
    <div class="kpi-strip">
      <div class="kpi-card blue">
        <div class="kpi-value">$60.0M</div>
        <div class="kpi-label">Ingresos Acumulados Totales</div>
        <div class="kpi-change up">‚ñ≤ Pico en Y2Q4: $4.87M</div>
      </div>
      <div class="kpi-card teal">
        <div class="kpi-value">$4.43M</div>
        <div class="kpi-label">Beneficio Acumulado Final</div>
        <div class="kpi-change up">‚ñ≤ Crecimiento hasta Y3Q3</div>
      </div>
      <div class="kpi-card yellow">
        <div class="kpi-value">$1.79M</div>
        <div class="kpi-label">Margen Bruto M√°x. (Y2Q4)</div>
        <div class="kpi-change down">‚ñº Comprimido en Y4</div>
      </div>
      <div class="kpi-card red">
        <div class="kpi-value">42.8%</div>
        <div class="kpi-label">Margen Bruto Promedio</div>
        <div class="kpi-change down">‚ñº Alza en costos variables</div>
      </div>
    </div>

    <div class="grid-2-3">
      <div class="chart-card">
        <div class="chart-title">Ingresos Totales vs. Margen Bruto ($)</div>
        <div class="chart-subtitle">Evoluci√≥n financiera completa</div>
        <div class="chart-wrapper"><canvas id="chartIngresos"></canvas></div>
      </div>
      <div class="chart-card">
        <div class="chart-title">Beneficio Acumulado ($)</div>
        <div class="chart-subtitle">Crecimiento progresivo del beneficio neto</div>
        <div class="chart-wrapper"><canvas id="chartAcum"></canvas></div>
      </div>
    </div>

    <div class="grid-3">
      <div class="chart-card">
        <div class="chart-title">Estructura de Costos (%)</div>
        <div class="chart-subtitle">Composici√≥n de gastos operativos ‚Äî Y4Q4</div>
        <div class="chart-wrapper"><canvas id="chartCostos"></canvas></div>
      </div>
      <div class="chart-card">
        <div class="chart-title">Ingreso Neto por Quarter ($)</div>
        <div class="chart-subtitle">Volatilidad de la rentabilidad</div>
        <div class="chart-wrapper"><canvas id="chartNeto"></canvas></div>
      </div>
      <div class="chart-card">
        <div class="chart-title">Mix de Ingresos ($)</div>
        <div class="chart-subtitle">Grandes vs Peque√±os Clientes</div>
        <div class="chart-wrapper"><canvas id="chartMix"></canvas></div>
      </div>
    </div>

    <div class="executive-summary">
      <h3>Conclusi√≥n Final de Nuestro Equipo (Grupo 5)</h3>
      <p>A lo largo de estos 16 trimestres, como equipo vivimos una curva de aprendizaje sumamente enriquecedora. Al inicio, nuestra estrategia se bas√≥ en una expansi√≥n agresiva para capitalizar el volumen de los grandes clientes (Segmento A). Esto nos impuls√≥ hacia nuestro mayor pico de ingresos de $4.87M en el A√±o 2. Sin embargo, nos dimos cuenta de que aplicar descuentos de forma prematura y no hacer crecer nuestra fuerza de ventas al mismo ritmo termin√≥ limitando nuestra rentabilidad futura.</p>
      <p>Durante el A√±o 3, logramos revertir temporalmente los n√∫meros en rojo enfoc√°ndonos estrat√©gicamente en el Segmento C y ajustando los m√°rgenes de los distribuidores para retener a los peque√±os clientes. Lamentablemente, cometimos un error de dise√±o en I+D al priorizar el peso del sensor sobre la bater√≠a. Esto golpe√≥ fuertemente la satisfacci√≥n de nuestros clientes m√°s importantes y nos demostr√≥, a la fuerza, que la calidad t√©cnica es innegociable.</p>
      <p>En la recta final (A√±o 4), hicimos esfuerzos por rescatar los segmentos B y C inyectando mayor inversi√≥n y nos refugiamos en los clientes peque√±os, quienes nos premiaron con 5 estrellas gracias a nuestro impecable servicio posventa. El costo de esta maniobra fue descuidar al Segmento A, el cual cay√≥ a un nivel 'Neutral', y perder definitivamente la cuenta del Segmento D. En conclusi√≥n, aprendimos que el crecimiento sostenible no se logra √∫nicamente bajando precios; exige un equilibrio milim√©trico entre la innovaci√≥n t√©cnica, nuestra capacidad operativa (fuerza de ventas) y el soporte brindado. Para nuestra pr√≥xima simulaci√≥n, nuestro enfoque central ser√° adquirir clientes de forma proactiva, mantener una diversificaci√≥n controlada y asegurar la excelencia operativa que tanto nos valoraron los minoristas.</p>
    </div>
  </div>

  <div id="panel-cuota" class="panel">
    <div class="section-label">Contraste de Estrategia: Cuota de Mercado e Ingresos (Y1Q3 vs Y4Q4)</div>
    
    <div class="grid-2">
      <div class="chart-card">
        <div class="chart-title">Punto de Partida (Y1Q3) ‚Äî Expansi√≥n General</div>
        <div class="chart-subtitle">Se abarcaba a todos los grandes clientes y a los peque√±os.</div>
        <div class="grid-2" style="margin-top: 20px;">
          <div>
            <div style="text-align:center; font-weight:600; font-size:0.85rem; margin-bottom:10px;">Cuota de Mercado Global (%)</div>
            <div class="chart-wrapper" style="height: 180px; min-height: 180px;"><canvas id="chartDonaCuotaY1Q3"></canvas></div>
          </div>
          <div>
            <div style="text-align:center; font-weight:600; font-size:0.85rem; margin-bottom:10px;">Reparto de Ingresos (M)</div>
            <div class="chart-wrapper" style="height: 180px; min-height: 180px;"><canvas id="chartDonaIngresosY1Q3"></canvas></div>
          </div>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-title">√öltima Foto (Y4Q4) ‚Äî Distribuci√≥n Actual</div>
        <div class="chart-subtitle">Dependencia enfocada en Grandes Clientes y Peque√±os Clientes.</div>
        <div class="grid-2" style="margin-top: 20px;">
          <div>
            <div style="text-align:center; font-weight:600; font-size:0.85rem; margin-bottom:10px;">Cuota de Mercado Global (%)</div>
            <div class="chart-wrapper" style="height: 180px; min-height: 180px;"><canvas id="chartDonaCuotaY4Q4"></canvas></div>
          </div>
          <div>
            <div style="text-align:center; font-weight:600; font-size:0.85rem; margin-bottom:10px;">Reparto de Ingresos (M)</div>
            <div class="chart-wrapper" style="height: 180px; min-height: 180px;"><canvas id="chartDonaIngresosY4Q4"></canvas></div>
          </div>
        </div>
      </div>
    </div>

    <div class="chart-card">
      <div class="chart-title">Crecimiento de Cuota de Mercado (Variaci√≥n Y4Q4)</div>
      <div class="chart-subtitle">Variaci√≥n porcentual refleja el enfoque en Peque√±os Clientes y contracci√≥n en Grandes Clientes.</div>
      <div class="chart-wrapper" style="min-height: 250px;"><canvas id="chartCrecimientoCuota"></canvas></div>
    </div>
  </div>

  <div id="panel-comercial" class="panel">
    <div class="section-label">√Årea Comercial ‚Äî Evoluci√≥n del Mercado</div>
    
    <div class="grid-2">
      <div class="chart-card">
        <div class="chart-title">Compras por Tipo de Cliente (Unidades)</div>
        <div class="chart-subtitle">Volumen de adopci√≥n en el mercado</div>
        <div class="chart-wrapper" style="min-height: 280px;"><canvas id="chartCompras"></canvas></div>
      </div>
      <div class="chart-card">
        <div class="chart-title">Ventas: Nuevos vs. Existentes</div>
        <div class="chart-subtitle">Retenci√≥n de cartera vs Adquisici√≥n</div>
        <div class="chart-wrapper" style="min-height: 280px;"><canvas id="chartVentas"></canvas></div>
      </div>
    </div>

    <div class="section-label" style="margin-top:30px;">Barra de Evoluci√≥n (Snapshot por Trimestre)</div>
    
    <div class="snapshot-control">
      <div class="snapshot-header">
        <span class="snapshot-title">Desliza para analizar el Quarter:</span>
        <span class="snapshot-value" id="sliderValue">Y4Q4</span>
      </div>
      <input type="range" id="quarterSlider" min="0" max="15" value="15" oninput="updateSnapshot(this.value)">
    </div>

    <div class="grid-2">
      <div class="chart-card">
        <div class="chart-title">Satisfacci√≥n del Cliente (1-5)</div>
        <div class="chart-subtitle">Niveles de satisfacci√≥n en el trimestre seleccionado</div>
        <div id="satBars" style="margin-top: 15px;"></div>
      </div>
      <div class="chart-card">
        <div class="chart-title">Comparativa de Precios en el Mercado ($)</div>
        <div class="chart-subtitle">Nuestro Precio vs Competencia en el trimestre seleccionado</div>
        <div class="chart-wrapper" style="min-height: 220px;"><canvas id="chartSnapshotPrecio"></canvas></div>
      </div>
    </div>
  </div>

  <div id="panel-fuerzaventas" class="panel">
    <div class="section-label">√Årea de Fuerza de Ventas ‚Äî Distribuci√≥n y Esfuerzo Operativo</div>
    
    <div class="kpi-strip">
      <div class="kpi-card blue">
        <div class="kpi-value">4,577</div>
        <div class="kpi-label">Pico M√°ximo de Horas (Y4Q2)</div>
        <div class="kpi-change up">‚ñ≤ Esfuerzo m√°ximo hist√≥rico de la plantilla</div>
      </div>
      <div class="kpi-card teal">
        <div class="kpi-value">Seg. A & C</div>
        <div class="kpi-label">Foco Principal Hist√≥rico</div>
        <div class="kpi-change up">‚ñ≤ Mayor asignaci√≥n de atenci√≥n</div>
      </div>
      <div class="kpi-card red">
        <div class="kpi-value">0 Horas</div>
        <div class="kpi-label">Abandono del Seg. B (Y4Q4)</div>
        <div class="kpi-change down">‚ñº Decisi√≥n cr√≠tica al final de la ronda</div>
      </div>
      <div class="kpi-card yellow">
        <div class="kpi-value">11 Reps</div>
        <div class="kpi-label">Tama√±o M√°ximo del Equipo</div>
        <div class="kpi-change down">‚ñº Fluctu√≥ entre 10 y 11 representantes</div>
      </div>
    </div>

    <div class="chart-card" style="margin-bottom: 20px;">
      <div class="chart-title">Evoluci√≥n Total de Horas Disponibles de Fuerza de Ventas</div>
      <div class="chart-subtitle">Crecimiento y contracci√≥n del esfuerzo total del equipo trimestre a trimestre</div>
      <div class="chart-wrapper" style="min-height: 260px;"><canvas id="chartTotalHoras"></canvas></div>
    </div>

    <div class="grid-2">
      <div class="chart-card">
        <div class="chart-title">√ânfasis en Fuerza de Ventas (%)</div>
        <div class="chart-subtitle">Distribuci√≥n porcentual del esfuerzo comercial por segmento</div>
        <div class="chart-wrapper" style="min-height: 260px;"><canvas id="chartDecisiones"></canvas></div>
      </div>
      <div class="chart-card">
        <div class="chart-title">Horas Asignadas por Segmento</div>
        <div class="chart-subtitle">Horas absolutas dedicadas a los grandes clientes</div>
        <div class="chart-wrapper" style="min-height: 260px;"><canvas id="chartHoras"></canvas></div>
      </div>
    </div>
  </div>

  <div id="panel-decisiones" class="panel">
    <div class="section-label">Decisiones vs. Resultados ‚Äî Estrategia de Pricing y M√°rgenes</div>
    
    <div class="grid-2">
      <div class="chart-card">
        <div class="chart-title">Evoluci√≥n de Precios Propios vs Competencia ($)</div>
        <div class="chart-subtitle">Hist√≥rico de precios para los 4 segmentos frente al promedio del mercado</div>
        <div class="chart-wrapper" style="min-height: 280px;"><canvas id="chartPrecioEvolucion"></canvas></div>
      </div>
      <div class="chart-card">
        <div class="chart-title">Margen Bruto Hist√≥rico por Segmento ($)</div>
        <div class="chart-subtitle">Contribuci√≥n financiera consolidada (16 Trimestres)</div>
        <div class="chart-wrapper" style="min-height: 280px;"><canvas id="chartMargenEvolucion"></canvas></div>
      </div>
    </div>

    <div class="chart-card">
      <div class="chart-title">Registro Completo de Decisiones (16 Trimestres)</div>
      <div class="chart-subtitle">Resumen comparativo de las palancas estrat√©gicas operadas por el equipo a lo largo del simulador</div>
      <br>
      <div class="table-responsive">
        <table class="decision-table">
          <thead>
            <tr>
              <th>Quarter</th>
              <th>√ânfasis A</th>
              <th>√ânfasis B</th>
              <th>√ânfasis C</th>
              <th>√ânfasis D</th>
              <th>Ingresos Totales</th>
              <th>Ingreso Neto</th>
              <th>Sat. A</th>
              <th>Sat. D</th>
              <th>Fase Estrat√©gica</th>
            </tr>
          </thead>
          <tbody id="decisionBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="panel-narrativa" class="panel">
    <div class="section-label">Reportes de Gesti√≥n del Equipo</div>
    
    <div class="narrative-box">
      <h3>Resumen de Gesti√≥n ‚Äì Y1Q4 a Y2Q1</h3>
      <p>Al inicio del periodo, nuestra empresa contaba con una participaci√≥n de mercado del <strong>8,51% en grandes clientes</strong> (ingresos de $2.254.913) y del <strong>19,13% en peque√±os clientes</strong> (ingresos de $890.749). Los segmentos presentaban tendencias negativas: A (-0.9%), B (-0.2%), C (-0.1%), D (-0.1%) y Peque√±os clientes (-0.2%).</p>
      <h4>Nuestra Estrategia Aplicada</h4>
      <p>Nos centramos en optimizar el beneficio e ingresos acumulados, la satisfacci√≥n del cliente y nuestra cuota de mercado. Las acciones clave que tomamos incluyeron:</p>
      <ul>
        <li><strong>Precios:</strong> Aplicamos descuentos estrat√©gicos por segmento.</li>
        <li><strong>Inversi√≥n:</strong> Priorizamos en I+D (rendimiento de bater√≠a), investigaci√≥n de mercado y eficiencia productiva.</li>
        <li><strong>Reinversi√≥n:</strong> Destinamos el excedente presupuestario √≠ntegramente a mejoras tecnol√≥gicas.</li>
      </ul>
      <h4>Resultados y Lecciones Aprendidas</h4>
      <p>Para el trimestre Y2Q1, el segmento de grandes clientes mostr√≥ un crecimiento exponencial, alcanzando un <strong>14,76% de cuota</strong> e ingresos por $4.159.356. No obstante, nuestro segmento de peque√±os clientes descendi√≥ al 14,86% ($712.860). Aunque priorizar a los grandes clientes result√≥ m√°s rentable, identificamos dos √°reas claras de mejora:</p>
      <ul>
        <li><strong>Negociaci√≥n:</strong> Un descuento inicial demasiado agresivo nos limit√≥ el margen de maniobra competitivo posteriormente.</li>
        <li><strong>Capacidad Operativa:</strong> El crecimiento de nuestra empresa no fue acompa√±ado por un aumento en la fuerza de ventas, lo que deriv√≥ en la p√©rdida de presencia en ciertos segmentos.</li>
      </ul>
    </div>

    <div class="narrative-box">
      <h3>Resumen de Gesti√≥n ‚Äì Y3Q1 al Y3Q4</h3>
      <h4>Nuestras Decisiones Acertadas</h4>
      <ul>
        <li><strong>Recuperaci√≥n de la Rentabilidad (Y3Q2):</strong> Logramos revertir la p√©rdida del a√±o anterior obteniendo un beneficio neto de <strong>$378,287</strong> en el segundo trimestre, lo cual estabiliz√≥ la confianza de la direcci√≥n.</li>
        <li><strong>Enfoque en el Segmento C (Y3Q3-Q4):</strong> Identificar que este segmento es el menos sensible al precio y m√°s rentable fue clave para nosotros. Al asignarles hasta un <strong>40% de nuestra fuerza de ventas</strong> al cierre, logramos proteger el margen bruto de la compa√±√≠a.</li>
        <li><strong>Margen de Distribuidores (Y3Q3):</strong> Supimos escuchar al mercado y ajustamos el margen del distribuidor al <strong>12%</strong>. Esto fue vital para que los "Peque√±os Clientes" no abandonaran nuestra marca, ya que ellos dependen totalmente de la disponibilidad en el cat√°logo.</li>
        <li><strong>Correcci√≥n de I+D en Bater√≠a (Y3Q3):</strong> Reaccionamos r√°pidamente con una inversi√≥n de <strong>$280,000</strong> tras nuestro error de dise√±o del Q2. Esto salv√≥ nuestra relaci√≥n con los Segmentos A y C, evitando una ca√≠da libre en la satisfacci√≥n.</li>
        <li><strong>Uso del Segmento D para Cuota de Mercado:</strong> El uso de descuentos agresivos en este segmento nos permiti√≥ mantener relevancia en volumen frente a competidores m√°s baratos.</li>
      </ul>
      <h4>Nuestras Decisiones No Acertadas (Errores de Aprendizaje)</h4>
      <ul>
        <li><strong>El "Trade-off" de Dise√±o en Y3Q2:</strong> Priorizamos el peso del sensor sin prever que esto reducir√≠a la bater√≠a. Fue nuestro error m√°s costoso del a√±o, ya que golpe√≥ la Satisfacci√≥n del Cliente en los dos segmentos que m√°s dinero nos aportan (A y C).</li>
        <li><strong>Abandono del Segmento D en Y3Q2:</strong> Asignar solo el <strong>5% de fuerza de ventas</strong> a este segmento provoc√≥ una p√©rdida de tracci√≥n en ventas masivas, afectando nuestra cuota de mercado inicial.</li>
        <li><strong>Baja Tasa de Adquisici√≥n de Clientes (Y3Q1-Y3Q3):</strong> Durante gran parte del a√±o, dependimos casi exclusivamente de nuestros clientes existentes (6.59%). Nuestra inversi√≥n en marketing fue reactiva y no proactiva para captar nuevos clientes (apenas 0.88% de captaci√≥n nueva).</li>
      </ul>
    </div>

    <div class="narrative-box">
      <h3>Resumen de Gesti√≥n ‚Äì Y4Q1 a Y4Q3</h3>
      <h4>Estrategia y Toma de Decisiones</h4>
      <ul>
        <li><strong>Priorizaci√≥n de Segmentos:</strong> Intentamos un rescate agresivo de nuestros Segmentos B y C aumentando su soporte t√©cnico y fuerza de ventas (llegando al 40% en el C para el Y4Q3).</li>
        <li><strong>Fuerza de Ventas:</strong> Aumentamos nuestra capacidad de <strong>10 a 11 unidades</strong> en Y4Q2, pero tuvimos que reducirla nuevamente a 10 en Y4Q3.</li>
        <li><strong>Inversi√≥n en Calidad:</strong> Incrementamos dr√°sticamente el gasto en Comunicaci√≥n y Formaci√≥n (de $15,000 a $50,000) y en Eficiencia de Fabricaci√≥n ($85,000) para detener nuestros errores t√©cnicos.</li>
        <li><strong>Refugio en Minoristas:</strong> Duplicamos el presupuesto para nuestros Peque√±os Clientes (de $110,000 a $200,000) buscando estabilizar los ingresos ante la crisis que ten√≠amos en las grandes cuentas.</li>
      </ul>
      <h4>Resultados de Satisfacci√≥n</h4>
      <ul>
        <li><strong>Segmento A (L√≠der en declive):</strong> Pasamos de tener una satisfacci√≥n m√°xima ("Muy Satisfecho") en Y4Q1 a un estado <strong>"Neutral"</strong> en Y4Q3 debido a nuestra reducci√≥n del soporte de ventas.</li>
        <li><strong>Peque√±os Clientes (√âxito sostenido):</strong> Se mantuvieron como el pilar de nuestra empresa con <strong>5 estrellas</strong>, valorando especialmente el servicio posventa y la fiabilidad de nuestros paquetes est√°ndar.</li>
        <li><strong>Segmentos B y C (Crisis t√©cnica):</strong> Permanecieron estancados en <strong>1-2 estrellas</strong>; nuestros clientes reportaron fallos cr√≠ticos de potencia y env√≠os que no cumpl√≠an con las especificaciones t√©cnicas prometidas.</li>
        <li><strong>Segmento D (P√©rdida de cuenta):</strong> Cayeron de "Satisfechos" a <strong>"Insatisfechos"</strong>, anunciando su cambio a un proveedor extranjero por falta de apoyo de nuestra parte en la reducci√≥n de sus costes.</li>
      </ul>
      <h4>Lecciones Aprendidas</h4>
      <p><strong>La Reputaci√≥n es Fr√°gil:</strong> Los errores t√©cnicos que tuvimos en los sensores (p√©rdida de potencia y est√°ndares incorrectos) generaron una desconfianza que ni las rebajas de precio ni nuestras consultas t√©cnicas pudieron revertir r√°pidamente.</p>
      <p><strong>Riesgo del Enfoque Selectivo:</strong> Al desviar demasiada atenci√≥n de nuestros segmentos sanos (como el A) para salvar los cr√≠ticos (B y C), pusimos en riesgo la satisfacci√≥n del cliente que resultaba m√°s rentable para nosotros.</p>
      <p><strong>El Valor de la Log√≠stica:</strong> Nuestra capacidad de reemplazar productos defectuosos sin hacer preguntas fue, sin duda, lo que blind√≥ la lealtad de nuestros peque√±os clientes frente a las fallas de f√°brica.</p>
    </div>

    <div class="narrative-box" style="border-left: 4px solid var(--accent3);">
      <h3>üö© Conclusi√≥n del Cierre de Gesti√≥n (Y4Q4)</h3>
      <p>La √∫ltima fase de gesti√≥n refleja una consolidaci√≥n de los errores acumulados y una toma de decisiones dr√°stica para detener la hemorragia de recursos:</p>
      <ul>
        <li><strong>Abandono del Segmento B:</strong> Se decidi√≥ eliminar totalmente la fuerza de ventas en el Segmento B. A pesar de los esfuerzos previos en inversi√≥n para reducir el tama√±o del sensor, no se logr√≥ un crecimiento sostenible, determinando que no era un mercado viable para nuestra estructura actual.</li>
        <li><strong>La Trampa del Precio (Segmento C):</strong> La experiencia en este segmento permite concluir que los descuentos agresivos iniciales fueron un error estrat√©gico fundamental. Al intentar recuperar m√°rgenes, los clientes se mostraron reacios al aumento de precio, erosionando la relaci√≥n comercial.</li>
        <li><strong>Impacto en Capacidad:</strong> Operar con solo 10 personas en el equipo comercial limit√≥ significativamente la cobertura de mercado. Aunque la participaci√≥n en Peque√±os Clientes aument√≥, esto no compens√≥ la ca√≠da en ingresos netos de las grandes cuentas.</li>
        <li><strong>Lecci√≥n Final:</strong> La rentabilidad futura depende de una estructura de ventas robusta y de evitar la competencia basada √∫nicamente en precio. La reputaci√≥n t√©cnica es el activo m√°s dif√≠cil de recuperar una vez da√±ado.</li>
      </ul>
    </div>

  </div>
</div>

<script>
function switchTab(btnElement, panelName) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById('panel-' + panelName).classList.add('active');
  btnElement.classList.add('active');
}

function getCSSVar(name) { return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }

function getDefaultChartOpts() {
  return {
    responsive: true, maintainAspectRatio: false,
    plugins: {
      legend: { labels: { color: getCSSVar('--text-chart'), font: { family: 'Poppins', size: 12 }, boxWidth: 12, padding: 15 } },
      tooltip: { backgroundColor: getCSSVar('--tooltip-bg'), borderColor: getCSSVar('--border'), borderWidth: 1, titleColor: getCSSVar('--text'), bodyColor: getCSSVar('--text-chart'), padding: 12, cornerRadius: 8, titleFont: { family: 'Poppins', weight: 'bold' } }
    },
    scales: {
      x: { ticks: { color: getCSSVar('--text-chart'), font: { family: 'Poppins', size: 11 } }, grid: { color: getCSSVar('--grid-chart') } },
      y: { ticks: { color: getCSSVar('--text-chart'), font: { family: 'Poppins', size: 11 } }, grid: { color: getCSSVar('--grid-chart') } }
    }
  };
}

const cbMoneyM = ctx => `${ctx.dataset.label}: $${(ctx.raw/1000000).toFixed(2)}M`;
const cbMoneyK = ctx => `${ctx.dataset.label}: $${(ctx.raw/1000).toFixed(0)}K`;
const cbMoneyExact = ctx => `${ctx.dataset.label}: $${ctx.raw.toLocaleString()}`;
const cbPct = ctx => `${ctx.dataset.label}: ${ctx.raw}%`;
const cbPctSign = ctx => `${ctx.dataset.label}: ${ctx.raw > 0 ? '+' : ''}${ctx.raw}%`;
const cbHrs = ctx => `${ctx.dataset.label}: ${ctx.raw.toLocaleString()} horas`;

let chartsList = [];
let snapshotPriceChart = null;

function makeChart(id, config) {
  const ctx = document.getElementById(id);
  if(!ctx) return;
  
  let finalOptions = getDefaultChartOpts();
  if(config.options) {
      if(config.options.scales) {
          if(config.options.scales.x) Object.assign(finalOptions.scales.x, config.options.scales.x);
          if(config.options.scales.y) Object.assign(finalOptions.scales.y, config.options.scales.y);
      }
      if(config.options.plugins) {
          if(config.options.plugins.tooltip) Object.assign(finalOptions.plugins.tooltip, config.options.plugins.tooltip);
          if(config.options.plugins.legend) Object.assign(finalOptions.plugins.legend, config.options.plugins.legend);
      }
      if(config.options.cutout) finalOptions.cutout = config.options.cutout;
  }
  const chartInstance = new Chart(ctx, { type: config.type, data: config.data, options: finalOptions });
  chartsList.push(chartInstance);
  return chartInstance;
}

function toggleTheme() {
  const root = document.documentElement;
  const btn = document.getElementById('themeToggle');
  if (root.getAttribute('data-theme') === 'light') { root.setAttribute('data-theme', 'dark'); btn.innerHTML = '‚òÄÔ∏è Modo Claro'; } 
  else { root.setAttribute('data-theme', 'light'); btn.innerHTML = 'üåô Modo Oscuro'; }

  const newOpts = getDefaultChartOpts();
  chartsList.forEach(chart => {
    if(chart.options.plugins && chart.options.plugins.legend) chart.options.plugins.legend.labels.color = newOpts.plugins.legend.labels.color;
    if(chart.options.plugins && chart.options.plugins.tooltip) {
      chart.options.plugins.tooltip.backgroundColor = newOpts.plugins.tooltip.backgroundColor;
      chart.options.plugins.tooltip.titleColor = newOpts.plugins.tooltip.titleColor;
      chart.options.plugins.tooltip.bodyColor = newOpts.plugins.tooltip.bodyColor;
      chart.options.plugins.tooltip.borderColor = newOpts.plugins.tooltip.borderColor;
    }
    if (chart.options.scales && chart.options.scales.x && chart.options.scales.x.ticks) { chart.options.scales.x.ticks.color = newOpts.scales.x.ticks.color; chart.options.scales.x.grid.color = newOpts.scales.x.grid.color; }
    if (chart.options.scales && chart.options.scales.y && chart.options.scales.y.ticks) { chart.options.scales.y.ticks.color = newOpts.scales.y.ticks.color; chart.options.scales.y.grid.color = newOpts.scales.y.grid.color; }
    chart.update();
  });
}

// ============================================================
// L√ìGICA DE RENDERIZADO DEL SNAPSHOT
// ============================================================
function updateSnapshot(index) {
  document.getElementById('sliderValue').innerText = quarters[index];
  
  const dataSat = [
    { label: 'Segmento A', score: satA[index] }, { label: 'Segmento B', score: satB[index] },
    { label: 'Segmento C', score: satC[index] }, { label: 'Segmento D', score: satD[index] },
    { label: 'Peq. Clientes', score: satPeq[index] },
  ];
  
  const satContainer = document.getElementById('satBars');
  satContainer.innerHTML = '';
  dataSat.forEach(s => {
    let color = s.score >= 4 ? 'var(--green)' : s.score >= 3 ? 'var(--accent4)' : 'var(--red)';
    satContainer.innerHTML += `
      <div class="sat-row">
        <span class="sat-label">${s.label}</span>
        <div class="sat-bar-bg"><div class="sat-bar-fill" style="width:${(s.score/5)*100}%; background:${color}"></div></div>
        <span class="sat-score">${s.score}/5</span>
      </div>`;
  });

  const priceData = [pA[index], pB[index], pC[index], pD[index]];
  const compData = [compMarket[index], compMarket[index], compMarket[index], compMarket[index]]; 
  
  if(snapshotPriceChart) {
    snapshotPriceChart.data.datasets[0].data = priceData;
    snapshotPriceChart.data.datasets[1].data = compData;
    snapshotPriceChart.update();
  } else {
    snapshotPriceChart = makeChart('chartSnapshotPrecio', {
      type: 'bar',
      data: {
        labels: ['Seg. A', 'Seg. B', 'Seg. C', 'Seg. D'],
        datasets: [
          { label: 'Nuestro Precio Neto', data: priceData, backgroundColor: colors.blue+'0.8)', borderRadius: 4 },
          { label: 'Competidor Promedio', data: compData, backgroundColor: colors.red+'0.8)', borderRadius: 4 }
        ]
      },
      options: { scales: { y: { min: 80, ticks: { callback: v => '$'+v } } }, plugins: { tooltip: { callbacks: { label: cbMoneyExact } } } }
    });
  }
}

// ============================================================
// DATA BASE (SIMULADOR)
// ============================================================
const quarters = ['Y1Q1','Y1Q2','Y1Q3','Y1Q4','Y2Q1','Y2Q2','Y2Q3','Y2Q4','Y3Q1','Y3Q2','Y3Q3','Y3Q4','Y4Q1','Y4Q2','Y4Q3','Y4Q4'];
const ingresosTotales = [3260534,3164040,3145662,3630809,4048308,4267651,4644544,4872216,3739624,3898667,4012228,3240156,3615923,3477970,3586920,3395824];
const margenBruto     = [1401415,1353964,1341216,1475887,1594381,1632863,1751213,1790922,1388056,1438709,1438643,1151410,1258399,1197638,1221574,1155835];
const ingresoNeto     = [390994,343543,330795,465466,583959,522442,520791,460501,77634,378287,368222,70988,312978,252217,241153,175414];
const beneficioAcum   = [0,0,0,465466,1049425,1571867,2092658,2553159,2630794,3009081,3377303,3448291,3761269,4013486,4254639,4430053];
const ingGrandes = [2370194,2282032,2254913,2992427,3475029,3663354,4002026,4159356,3150601,3467418,3618656,2929061,3282889,3122568,3028657,2778889];
const ingPeq     = [890340,882008,890749,638382,573278,604296,642518,712860,589022,431248,393571,311095,333034,355402,558262,616934];
const compGrandes = [18976,18292,18082,24913,28867,30403,33189,34466,25923,28719,29929,23989,27150,25869,25149,23156];
const compPeq     = [7125,7058,7128,5109,4750,5007,5142,6122,5059,3704,3465,2672,2860,3129,4914,5431];

const enfA = [0.25, 0.25, 0.25, 0.40, 0.40, 0.40, 0.40, 0.35, 0.40, 0.40, 0.30, 0.30, 0.30, 0.30, 0.30, 0.30];
const enfB = [0.25, 0.25, 0.25, 0.15, 0.10, 0.15, 0.15, 0.20, 0.30, 0.20, 0.20, 0.20, 0.20, 0.20, 0.20, 0.00]; 
const enfC = [0.25, 0.25, 0.25, 0.30, 0.40, 0.40, 0.40, 0.40, 0.25, 0.35, 0.40, 0.40, 0.40, 0.40, 0.40, 0.60];
const enfD = [0.25, 0.25, 0.25, 0.15, 0.10, 0.05, 0.05, 0.05, 0.05, 0.05, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10];
const horasA = [715,715,715,1602,1602,1373,1373,1201,1622,1830,1404,1216,1872,2288,1092,1248];
const horasB = [715,715,715,601,400,515,515,686,1217,915,936,729,1248,458,624,0];
const horasC = [715,715,715,1201,1602,1373,1373,1373,1014,1602,1404,1945,832,1373,1248,1248];
const horasD = [715,715,715,601,400,172,172,172,203,229,936,972,208,458,156,624];
const horasTotales = horasA.map((h, i) => h + horasB[i] + horasC[i] + horasD[i]);

const satA = [3,3,3,5,5,5,5,5,5,5,5,5,5,4,3,3];
const satB = [1,1,1,3,2,2,2,2,2,2,2,2,2,1,1,1];
const satC = [1,1,1,2,2,2,2,2,1,1,2,1,1,1,1,1];
const satD = [2,2,2,5,5,4,4,4,3,4,4,3,4,3,2,1];
const satPeq = [5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5];

const pA = [124.96, 124.96, 124.96, 124.96, 124.96, 124.34, 124.34, 124.34, 127.80, 120.70, 120.70, 120.70, 115.00, 115.00, 110.00, 110.00];
const pB = [130.64, 130.64, 130.64, 130.64, 125.00, 125.00, 125.00, 120.00, 113.60, 130.64, 130.64, 125.00, 125.00, 120.00, 115.00, 115.00];
const pC = [136.32, 136.32, 136.32, 136.32, 130.00, 130.00, 130.00, 125.00, 127.80, 136.32, 136.32, 130.00, 130.00, 125.00, 120.00, 120.00];
const pD = [119.28, 119.28, 119.28, 119.28, 115.00, 115.00, 115.00, 110.00, 113.60, 113.60, 113.60, 110.00, 110.00, 105.00, 100.00, 100.00];
const compMarket = [115, 115, 115, 115, 115, 115, 115, 115, 113, 112, 112, 110, 110, 108, 105, 105];

const margenA = [509, 486, 474, 546, 648, 684, 745, 769, 608, 585, 610, 520, 535, 515, 490, 460].map(v=>v*1000);
const margenB = [124, 108, 104, 116, 117, 115, 118, 119, 75,  129, 115, 95,  85,  80,  70,  50].map(v=>v*1000);
const margenC = [111, 105, 104, 140, 179, 189, 209, 225, 143, 191, 215, 185, 195, 180, 175, 165].map(v=>v*1000);
const margenD = [273, 275, 277, 401, 422, 411, 423, 428, 355, 382, 365, 315, 325, 310, 305, 285].map(v=>v*1000);

const strategiesList = ['Equitativo', 'Equitativo', 'Equitativo', 'Pivot A+C', 'A+C intensivo', 'A+C m√°x.', 'Sostenimiento', 'Pico ingresos', 'A+B+C Rebalance', 'Estabilizaci√≥n', 'Foco Seg C', 'Ajuste I+D', 'Rescate B+C', 'Aumento FV', 'Crisis Soporte', 'Abandono B'];
const colors = { blue: 'rgba(79, 139, 255,', teal: 'rgba(0, 229, 195,', red: 'rgba(239, 68, 68,', yellow: 'rgba(245, 158, 11,', green: 'rgba(16, 185, 129,' };

// ============================================================
// INICIALIZACI√ìN DE GR√ÅFICOS
// ============================================================
window.onload = function() {
  updateSnapshot(15);
  
  // DONAS CUOTA E INGRESOS (Y1Q3 vs Y4Q4)
  const donutOpts = { scales: { x: { display: false }, y: { display: false } }, cutout: '65%', plugins: { legend: { position: 'bottom' } } };
  
  makeChart('chartDonaCuotaY1Q3', { type: 'doughnut', data: { labels: ['Grandes Clientes', 'Peque√±os Clientes', 'Competencia'], datasets: [{ data: [8.51, 19.13, 72.36], backgroundColor: [colors.blue+'0.8)', colors.yellow+'0.8)', 'rgba(150,150,150,0.15)'], borderWidth: 0 }] }, options: donutOpts });
  makeChart('chartDonaIngresosY1Q3', { type: 'doughnut', data: { labels: ['Grandes Clientes', 'Peque√±os Clientes'], datasets: [{ data: [2.25, 0.89], backgroundColor: [colors.blue+'0.8)', colors.yellow+'0.8)'], borderWidth: 0 }] }, options: donutOpts });
  
  makeChart('chartDonaCuotaY4Q4', { type: 'doughnut', data: { labels: ['Grandes Clientes', 'Peque√±os Clientes', 'Competencia'], datasets: [{ data: [8.42, 23.50, 68.08], backgroundColor: [colors.red+'0.8)', colors.green+'0.8)', 'rgba(150,150,150,0.15)'], borderWidth: 0 }] }, options: donutOpts });
  makeChart('chartDonaIngresosY4Q4', { type: 'doughnut', data: { labels: ['Grandes Clientes', 'Peque√±os Clientes'], datasets: [{ data: [2.78, 0.62], backgroundColor: [colors.red+'0.8)', colors.green+'0.8)'], borderWidth: 0 }] }, options: donutOpts });

  // CRECIMIENTO CUOTA DE MERCADO (BAR CHART)
  makeChart('chartCrecimientoCuota', {
    type: 'bar',
    data: {
      labels: ['Segmento A', 'Segmento B', 'Segmento C', 'Segmento D', 'Peque√±os Clientes'],
      datasets: [
        { label: 'Crecimiento Y4Q4 (%)', data: [-1.9, -0.3, -1.0, -0.7, 0.9], backgroundColor: colors.yellow+'0.8)', borderRadius: 4 }
      ]
    },
    options: { scales: { y: { ticks: { callback: v => v+'%' } } }, plugins: { tooltip: { callbacks: { label: cbPctSign } } } }
  });

  // FINANCIERO
  makeChart('chartIngresos', { type: 'bar', data: { labels: quarters, datasets: [{ label: 'Ingresos Totales', data: ingresosTotales, backgroundColor: colors.blue+'0.8)', borderRadius: 3, yAxisID: 'y' }, { label: 'Margen Bruto', data: margenBruto, type: 'line', borderColor: colors.teal+'1)', backgroundColor: colors.teal+'0.1)', fill: true, tension: 0.3, borderWidth: 2, yAxisID: 'y' }] }, options: { scales: { y: { ticks: { callback: v => '$'+(v/1000000).toFixed(1)+'M' } } }, plugins: { tooltip: { callbacks: { label: cbMoneyM } } } } });
  makeChart('chartAcum', { type: 'line', data: { labels: quarters, datasets: [{ label: 'Beneficio Acumulado', data: beneficioAcum, borderColor: colors.green+'1)', backgroundColor: colors.green+'0.1)', fill: true, tension: 0.4, borderWidth: 2.5 }] }, options: { scales: { y: { ticks: { callback: v => '$'+(v/1000000).toFixed(1)+'M' } } }, plugins: { tooltip: { callbacks: { label: cbMoneyM } } } } });
  makeChart('chartCostos', { type: 'doughnut', data: { labels: ['Costo Variable','SG&A','R&D','Inv. Mercados','Otros Op.'], datasets: [{ data: [2239989,550000,180000,120000,130421], backgroundColor: [ colors.red+'0.8)', colors.blue+'0.8)', colors.yellow+'0.8)', colors.teal+'0.8)', colors.green+'0.8)' ], borderWidth: 0 }] }, options: { scales: { x: { display: false }, y: { display: false } }, plugins: { legend: { position: 'right' }, tooltip: { callbacks: { label: cbMoneyExact } } } } });
  makeChart('chartNeto', { type: 'bar', data: { labels: quarters, datasets: [{ label: 'Ingreso Neto', data: ingresoNeto, backgroundColor: ingresoNeto.map(v => v > 0 ? colors.green+'0.7)' : colors.red+'0.7)'), borderRadius: 3 }] }, options: { scales: { y: { ticks: { callback: v => '$'+(v/1000).toFixed(0)+'K' } } }, plugins: { tooltip: { callbacks: { label: cbMoneyK } } } } });
  makeChart('chartMix', { type: 'bar', data: { labels: quarters, datasets: [{ label: 'Grandes Clientes', data: ingGrandes, backgroundColor: colors.blue+'0.8)', stack: 'ing' }, { label: 'Peque√±os Clientes', data: ingPeq, backgroundColor: colors.yellow+'0.8)', stack: 'ing' }] }, options: { scales: { x: { stacked: true }, y: { stacked: true, ticks: { callback: v => '$'+(v/1000000).toFixed(1)+'M' } } }, plugins: { tooltip: { callbacks: { label: cbMoneyM } } } } });

  // COMERCIAL
  makeChart('chartCompras', { type: 'line', data: { labels: quarters, datasets: [{ label: 'Grandes Clientes (u)', data: compGrandes, borderColor: colors.blue+'1)', backgroundColor: colors.blue+'0.1)', fill: true, tension: 0.3 }, { label: 'Peque√±os Clientes (u)', data: compPeq, borderColor: colors.yellow+'1)', backgroundColor: colors.yellow+'0.1)', fill: true, tension: 0.3 }] } });
  makeChart('chartVentas', { type: 'bar', data: { labels: quarters, datasets: [{ label: 'G - Nuevos', data: [10255,9600,9228,13483,15571,17115,19075,19908,13618,15337,16255,12611,14817,13766,13527,12219], backgroundColor: colors.blue+'0.9)', stack: 'grandes' }, { label: 'G - Existentes', data: [8721,8692,8854,11430,13296,13288,14114,14558,12305,13382,13674,11378,12333,12103,11622,10937], backgroundColor: colors.blue+'0.4)', stack: 'grandes' }, { label: 'P - Nuevos', data: [1425,1357,1320,1020,950,1001,1028,1224,1012,741,693,534,572,626,983,1086], backgroundColor: colors.yellow+'0.9)', stack: 'peq' }, { label: 'P - Existentes', data: [5700,5701,5808,4089,3800,4006,4114,4898,4047,2963,2772,2138,2288,2503,3931,4345], backgroundColor: colors.yellow+'0.4)', stack: 'peq' }] }, options: { scales: { x: { stacked: true }, y: { stacked: false } } } });

  // FUERZA DE VENTAS
  makeChart('chartTotalHoras', { type: 'bar', data: { labels: quarters, datasets: [{ label: 'Total Horas de FV', data: horasTotales, backgroundColor: colors.teal+'0.8)', borderRadius: 4 }] }, options: { plugins: { tooltip: { callbacks: { label: cbHrs } } } } });
  makeChart('chartDecisiones', { type: 'bar', data: { labels: quarters, datasets: [{ label: '√ânfasis A', data: enfA.map(v=>v*100), backgroundColor: colors.green+'0.8)', stack: 'enf' }, { label: '√ânfasis B', data: enfB.map(v=>v*100), backgroundColor: colors.red+'0.8)', stack: 'enf' }, { label: '√ânfasis C', data: enfC.map(v=>v*100), backgroundColor: colors.teal+'0.8)', stack: 'enf' }, { label: '√ânfasis D', data: enfD.map(v=>v*100), backgroundColor: colors.yellow+'0.8)', stack: 'enf' }] }, options: { scales: { x: { stacked: true }, y: { stacked: true, min:0, max:100, ticks: { callback: v => v+'%' } } }, plugins: { tooltip: { callbacks: { label: cbPct } } } } });
  makeChart('chartHoras', { type: 'line', data: { labels: quarters, datasets: [{ label: 'Seg. A', data: horasA, borderColor: colors.green+'1)', tension: 0.2 }, { label: 'Seg. B', data: horasB, borderColor: colors.red+'1)', tension: 0.2 }, { label: 'Seg. C', data: horasC, borderColor: colors.teal+'1)', tension: 0.2 }, { label: 'Seg. D', data: horasD, borderColor: colors.yellow+'1)', tension: 0.2 }] } });

  // DECISIONES (PRICING & M√ÅRGENES)
  makeChart('chartPrecioEvolucion', { type: 'line', data: { labels: quarters, datasets: [{ label: 'Precio Neto A', data: pA, borderColor: colors.green+'1)', tension: 0.2, fill: false }, { label: 'Precio Neto B', data: pB, borderColor: colors.red+'1)', tension: 0.2, fill: false }, { label: 'Precio Neto C', data: pC, borderColor: colors.teal+'1)', tension: 0.2, fill: false }, { label: 'Precio Neto D', data: pD, borderColor: colors.yellow+'1)', tension: 0.2, fill: false }, { label: 'Competidor Promedio', data: compMarket, borderColor: colors.blue+'0.8)', borderDash: [5,5], tension: 0.2, fill: false }] }, options: { scales: { y: { min: 90, ticks: { callback: v => '$'+v } } }, plugins: { tooltip: { callbacks: { label: cbMoneyExact } } } } });
  makeChart('chartMargenEvolucion', { type: 'bar', data: { labels: quarters, datasets: [{ label: 'Seg. A', data: margenA, backgroundColor: colors.green+'0.8)', stack: 'marg', borderRadius: 2 }, { label: 'Seg. B', data: margenB, backgroundColor: colors.red+'0.8)', stack: 'marg', borderRadius: 2 }, { label: 'Seg. C', data: margenC, backgroundColor: colors.teal+'0.8)', stack: 'marg', borderRadius: 2 }, { label: 'Seg. D', data: margenD, backgroundColor: colors.yellow+'0.8)', stack: 'marg', borderRadius: 2 }] }, options: { scales: { x: { stacked: true }, y: { stacked: true, ticks: { callback: v => '$'+(v/1000).toFixed(0)+'K' } } }, plugins: { tooltip: { callbacks: { label: cbMoneyK } } } } });

  const tbody = document.getElementById('decisionBody');
  quarters.forEach((q, i) => {
    const a = enfA[i], b = enfB[i], c = enfC[i], dd = enfD[i];
    const ingr = ingresosTotales[i], neto = ingresoNeto[i], sA = satA[i], sD = satD[i];
    const pillA = a >= 0.4 ? 'pill-high' : a >= 0.3 ? 'pill-med' : 'pill-low';
    const pillD = dd <= 0.1 ? 'pill-low' : 'pill-med';
    const netoColor = neto < 200000 ? 'var(--red)' : neto > 500000 ? 'var(--green)' : 'var(--accent4)';
    tbody.innerHTML += `<tr>
      <td style="color:var(--muted);font-weight:700">${q}</td>
      <td><span class="pill ${pillA}">${(a*100).toFixed(0)}%</span></td>
      <td><span class="pill pill-low">${(b*100).toFixed(0)}%</span></td>
      <td><span class="pill pill-med">${(c*100).toFixed(0)}%</span></td>
      <td><span class="pill ${pillD}">${(dd*100).toFixed(0)}%</span></td>
      <td style="color:var(--accent);font-weight:700">$${(ingr/1000000).toFixed(2)}M</td>
      <td style="color:${netoColor};font-weight:700">$${(neto/1000).toFixed(0)}K</td>
      <td style="font-weight:800;color:${sA>=4?'var(--green)':sA>=3?'var(--accent4)':'var(--red)'}">${sA}/5</td>
      <td style="font-weight:800;color:${sD>=4?'var(--green)':sD>=3?'var(--accent4)':'var(--red)'}">${sD}/5</td>
      <td style="color:var(--muted);font-weight:500">${strategiesList[i]}</td>
    </tr>`;
  });
};
</script>
</body>
</html>